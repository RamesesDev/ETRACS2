import com.rameses.annotations.*
import com.rameses.eserver.*;
import com.rameses.common.*;

class FAASMessageInterceptor
{
	@PersistenceContext('main')
	def em
    
	@Service('LogService')
    def logSvc
    
    @Service('FAASService')
    def faasSvc 
	
	def SCHEMA_NAME = 'faas'
    def SCHEMA_VERSION = '1.0'
    def LISTSCHEMA_NAME = 'faas:faaslist'
    
	@After(pattern='MessageService.onreceive') 
	public void interceptOnReceive( evt ) {
        def msg = evt.result 
        if( msg.action == 'faas.approve') {
            try {
                println 'Processing message -> ' + msg.action 
                faasSvc.onlineApprove( msg.data.faasid, msg.data  )
                logSvc.log('ONLINE-APPROVAL', 'FAAS', msg.data.faasid )
            }
            catch( e ) {
                println '-'*30
                e.printStackTrace()
                println '-'*30
                throw e 
            }
        }
	}
	
}


