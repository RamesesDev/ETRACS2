<workunit>
    <invokers>
        <invoker type="value_handler:classification_lookup" caption="Select Account" target="popup"/>
    </invokers>
    <code>
<![CDATA[

        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*

        class ClassificationLookupController {
        
            @Binding
            def binding

            def searchText
            def selectedItem
            def selectedItems = [];
            def handler

            def select() {
                if( handler ) handler( selectedItems )
                return '_close' 
            }

            def remove() {
                if( selectedItem ) {
                    selectedItems.remove( selectedItem )
                }
            }

            def selectAcctHandler = { o ->
                if( ! selectedItems.find{ it.objid == o.objid } ) {
                    selectedItems.add([ objid: o.classid, name : o.classname ]);
                }
                searchText = null
                binding.refresh( 'searchText' )
                binding.refresh('selectedItem')
            }

            def lookup() {
                return InvokerUtil.lookupOpener('propertyclass.lookup', [searchText:searchText, onselect:selectAcctHandler])
            }

        }


        ]]>
    </code>
    <pages>
        <page template="rulemgmt.support.MultiValueLookupPage"/>
    </pages>
</workunit>